<!-- event.html - Page where users select their availability -->
<!-- code formatted using the Prettier extension -->
 <!-- Documentation: www.w3schools.com-->
  <!-- Referenced ChatGPT: www.chatgpt.com for how to begin implementing Google sign in-->

<!-- html declaration -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Character encoding: UTF-8 supports all Unicode characters -->
    <meta charset="UTF-8" />
    <title>HSync â€” Availability</title>

    <!-- viewport tag for mobile friendly design -->
    <!-- width=device-width: Use device's screen width -->
    <!-- scale=1: No zoom on initial load -->
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Link to css to style the page -->
    <link rel="stylesheet" href="styles.css" />

    <!-- Google Identity Services (GSI) script for Google Sign-In -->
    <!-- Enables Google Sign-In button in the topbar -->
    <!-- async to load script asynchronously -->
    <!-- defer to execute after HTML is complete -->
    <!-- Documentation: https://developers.google.com/identity/gsi/web -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
  </head>

  <!-- body content -->

  <body class="page page-event">
    <!-- class for the event page -->

    <header class="topbar">
      <!-- set class for the topbar -->
      <div class="topbar-left">
        <!-- formatting for the brand -->
        <div class="brand" style="margin-right: 12px">
          <div
            id="topbar-signin"
            style="display: flex; align-items: center; gap: 8px"
          >
            <!-- 
              Documentation: https://docs.cloud.google.com/storage/docs/cloud-console
              The Google Sign-In button is dynamically rendered here by main.js
              using the Google Identity Services API
            -->
            <div id="gsi-topbar" style="display: inline-flex"></div>

            <!-- 
              User profile picture (shown after sign-in)
              Picture shows up when user signs in with google
              Used with code in main to remember user
            -->
            <img
              id="topbar-profile-pic"
              alt="Profile"
              style="
                width: 36px;
                height: 36px;
                border-radius: 50%;
                display: none;
                object-fit: cover;
              "
            />

            <!-- Application name/brand -->
            <span class="brand-text">HSync</span>
          </div>
        </div>

        <!-- 
         Where the event title is displayed
        -->
        <div id="event-title" class="topbar-subtitle"></div>
      </div>

      <!-- Navigation Links -->
      <nav class="topbar-nav">
        <!-- Home page-->
        <a href="index.html" class="topbar-link">Home</a>
        <!-- Join page-->
        <a href="join.html" class="topbar-link">Join</a>
        <!-- Current page indicator -->
        <a href="event.html" class="topbar-link topbar-link--active">Event</a>
      </nav>
    </header>

    <!-- main content area -->
    <main class="main main-event">
      <!-- User Input -->
      <section class="card card-primary">
        <div class="event-meta">
          <!-- Share Link Row -->
          <div class="share-row">
            <label class="share-label">
              Share this link with others:
              <!-- 
                Documentation:https://www.w3schools.com/js/js_window_location.asp
                Read-only input field containing the current page URL
                Users can click to select and copy the link to share the event
                Populated by main.js with window.location.href
                onclick="this.select()" automatically selects all text when clicked
              -->
                <!-- Documentation: https://stackoverflow.com/questions/10413704/how-to-select-value-of-input-onclick -->
              <input
                type="text"
                id="share-link"
                readonly
                onclick="this.select()"
              />
            </label>
          </div>

          <!-- Participant Input Row -->
          <div class="participant-row">
            <!-- Manual name input -->
            <label>
              Your name
              <!-- 
                 Text input for participant name
                 Value is saved to localStorage and restored on page load
                 Used when saving availability to identify the participant
                 Example names chosen for placeholders
               -->
              <input
                type="text"
                id="participant-name"
                placeholder="e.g. Emma, Alex, Chris"
              />
            </label>

            <!-- 
               Save button - Submits selected availability slots to the server
               Click handler attached by main.js in initEventPage()
               Sends POST request to /api/events/:id/availability
             -->
            <button id="save-availability" class="btn btn-primary">
              Save my availability
            </button>

            <!-- 
               Add clear button to clear selections
               Does not affect server data, only clears the current selection
               Useful for starting over without reloading the page
             -->
            <button id="clear-availability" class="btn btn-ghost">
              Clear mine
            </button>
          </div>

          <!-- Calendar Overlay Row -->
          <div class="calendar-overlay-row">
            <!-- 
              Calendar overlay button that finds user's calendar events
              Click handler attached by main.js
              Prompts for Google Calendar access if not already granted
              Fetches calendar events and marks overlapping time slots as "busy"
            -->
            <button id="load-calendar-overlay" class="btn btn-ghost">
              Overlay my Google Calendar
            </button>

            <!-- 
              From Google Calendar documentation
            -->
            <p id="calendar-overlay-status" class="helper-text"></p>
          </div>

          <!-- User tip/instructions -->
          <p class="helper-text">
            Tip: drag across the grid to select multiple times on touch or
            mouse, or use the range selector below.
          </p>
        </div>
      </section>

      <!-- Availability Grid of Cells-->
      <section class="card card-grid">
        <!-- 
          Grid wrapper container
        -->
        <div class="grid-wrapper">
          <!-- 
            Availability grid container
            This is where the interactive availability grid is rendered
            ChatGPT assisted in creating the structure
            Structure:
            - Header row with day labels
            - Time rows with time labels and availability cells
            - Each cell represents a time slot and shows:
              * Heatmap color based on number of available participants
              * User's own selections (highlighted)
              * Calendar conflicts (marked as busy)
            Generated by renderGrid() in main.js
          -->
          <div id="availability-grid"></div>
        </div>

        <!-- Range Selector -->
        <div class="range-select">
          <h3>Quick range select</h3>
          <div class="form-row">
            <!-- 
              Day selector dropdown
            -->
            <label>
              Day
              <select id="range-day"></select>
            </label>

            <!-- 
              Start time input
            -->
            <label>
              From
              <input type="time" id="range-from" />
            </label>

            <!-- 
              End time input
              Must be after start time
            -->
            <label>
              To
              <input type="time" id="range-to" />
            </label>

            <!-- 
              Apply range button
              Part of implementation to solve mobile difficulty
            -->
            <button id="range-apply" class="btn btn-outline">Add range</button>
          </div>
          <p class="helper-text">
            Use this if tapping each block is annoying on mobile.
          </p>
        </div>
      </section>

      <!-- section containing best times-->
      <section class="card card-secondary">
        <h3>Best times so far</h3>
        <!-- 
        Documentation: ChatGPT
        ChatGPT assisted implementation
          Best slots list container
          Dynamically populated by main.js with the top 5 time slots
          that have the most participants available
          Each item shows:
            - Date and time
            - Number of available participants
            - Dropdown list of participant names
          Generated by renderBestSlots() in main.js
        -->
        <ul id="best-slots" class="best-slots-list"></ul>

        <!-- 
          Participant count display
        -->
        <p class="helper-text" id="participant-count"></p>
      </section>
    </main>

    <footer class="footer">
      <!-- User instructions -->
      <span>Click or drag to select, tap again to unselect.</span>
    </footer>

    <!-- Documentation: https://www.w3schools.com/tags/att_script_defer.asp
    -->
    <script src="main.js" defer></script>
  </body>
</html>
